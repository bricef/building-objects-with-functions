<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.4
Version: 3.9.0
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>Metronic | Dashboard</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="" name="description"/>
<meta content="" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN PAGE LEVEL PLUGIN STYLES -->
<link href="assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css"/>
<!-- END PAGE LEVEL PLUGIN STYLES -->
<!-- BEGIN PAGE STYLES -->
<link href="assets/admin/pages/css/tasks.css" rel="stylesheet" type="text/css"/>
<!-- END PAGE STYLES -->
<!-- BEGIN THEME STYLES -->
<link href="assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css"/>
<link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
<link href="assets/admin/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css" id="style_color"/>
<link href="assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>

<link href="css/style.css" rel="stylesheet" type="text/css"/>

<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<!-- END HEAD -->




<!-- BEGIN BODY -->
<!-- DOC: Apply "page-header-fixed-mobile" and "page-footer-fixed-mobile" class to body element to force fixed header or footer in mobile devices -->
<!-- DOC: Apply "page-sidebar-closed" class to the body and "page-sidebar-menu-closed" class to the sidebar menu element to hide the sidebar by default -->
<!-- DOC: Apply "page-sidebar-hide" class to the body to make the sidebar completely hidden on toggle -->
<!-- DOC: Apply "page-sidebar-closed-hide-logo" class to the body element to make the logo hidden on sidebar toggle -->
<!-- DOC: Apply "page-sidebar-hide" class to body element to completely hide the sidebar on sidebar toggle -->
<!-- DOC: Apply "page-sidebar-fixed" class to have fixed sidebar -->
<!-- DOC: Apply "page-footer-fixed" class to the body element to have fixed footer -->
<!-- DOC: Apply "page-sidebar-reversed" class to put the sidebar on the right side -->
<!-- DOC: Apply "page-full-width" class to the body element to have full width page without the sidebar menu -->
<body class="page-header-fixed page-full-width page-container-bg-solid">





<!-- BEGIN HEADER -->
<div class="page-header navbar navbar-fixed-top">
	<!-- BEGIN HEADER INNER -->
	<div class="page-header-inner">
		
		<!-- BEGIN TOP NAVIGATION MENU -->
		<ul class="nav navbar-nav pull-left">
			<h4 class="course-title">Building Objects With Functions</h4>
		</ul>

		<div class="top-menu">
			<ul class="nav navbar-nav pull-right">
				<!-- BEGIN USER LOGIN DROPDOWN -->
				<!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
				<li class="dropdown dropdown-user">
					<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
					<img alt="" class="img-circle" src="img/brice-face-small.png"/>
					<span class="username username-hide-on-mobile">
					Brice Fernandes </span>
					<!-- <i class="fa fa-angle-down"></i> -->
					</a>
					<ul class="dropdown-menu dropdown-menu-default">
						<li>
							<a href="https://twitter.com/fractallambda">
							<i class="fa fa-twitter"></i> Twitter </a>
						</li>
						<li>
							<a href="mailto:brice@fractallambda.com	">
							<i class="fa fa-envelope"></i> Email </a>
						</li>
						<li>
							<a href="https://github.com/bricef/building-objects-with-functions">
							<i class="fa fa-github"></i> Fork on Github
							</a>
						</li>
					</ul>
				</li>
				<!-- END USER LOGIN DROPDOWN -->

				<li id="fullscreen-toggle" class="dropdown">
					<!-- <a href="#"><i class="icon-size-actual" style="color:white"></i></a> -->
					<a href="#"><i class="icon-size-fullscreen" style="color:white"></i></a>
				</li>
		</div>
		<!-- END TOP NAVIGATION MENU -->
	</div>
	<!-- END HEADER INNER -->
</div>
<!-- END HEADER -->
<div class="clearfix">
</div>

<!-- BEGIN CONTAINER -->
<div class="page-container">
	
	<!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
			<div id="editor-pane" class="row">
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6"></div>
				<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
					<div class="portlet box green">
						<div class="portlet-title">
							<!-- <div class="caption">Run Code</div> -->
							<div class="tools">
								<a href="#" class="reload"></a>
							</div>
							<ul class="nav nav-tabs">
								<li class="active">
									<a href="#editor-editor" data-toggle="tab" aria-expanded="true">
									Editor</a>
								</li>
								<!-- <li class="">
									<a href="#editor-environment" data-toggle="tab" aria-expanded="false">
									Environment </a>
								</li> -->
								<li class="">
									<a href="#editor-console" data-toggle="tab" aria-expanded="false">
									Console </a>
								</li>
								<!-- <li class="">
									<a href="#editor-options" data-toggle="tab" aria-expanded="false">
									Options </a>
								</li> -->
							</ul>
						</div>

						<div class="portlet-body">





							<!-- 
								EDITOR EDITOR 
							-->
							<div class="tab-content">
								<div class="tab-pane active" id="editor-editor">
									<div id="main-editor" class="row"></div>
									<div id="editor-buttons">
										<p class="text-danger pull-left">error occured!</p>
										<a href="#" class="editor-status editor-error btn btn-large red pull-right">
											<i class="fa fa-warning"></i>
										</a>
										<a href="#" class="editor-status editor-loading btn btn-large yellow pull-right">
											<i class="fa fa-refresh"></i>
										</a>
										<a href="#" class="editor-status editor-ok btn btn-large green pull-right">
											<i class="fa fa-check"></i>
										</a>
										<div class="clearfix"></div>
									</div>
								</div>




								


								<!-- 
									EDITOR ENVIRONMENT
								-->
								<!-- <div class="tab-pane" id="editor-environment">
									<p>These are not the droids you're looking for.</p>
								</div> -->






								<!--
									EDITOR CONSOLE
								-->
								<div class="tab-pane" id="editor-console">
									<div id="console-container">
										<div id="history"></div>
										<div id="prompt" type="textarea"></div>
									</div>
								</div>





								<!--
									EDITOR OPTIONS
								-->
								<!-- <div class="tab-pane form" id="editor-options">
									<form id="options-form" class="form-horizontal">
										<input type="checkbox" name="my-checkbox" checked>
										<label> Enable invisible characters</label>
									</form>
								</div> -->




							</div>
							
						</div>
					</div>
				</div>
			</div> <!-- END EDITOR PANE-->

			<div id="content-pane" class="row">
				<div id="main-lesson-flow" class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
					
					<script id="template-heading" type="text/x-handlebars-template">
						<div class="dashboard-stat blue-madison">
							<div class="visual">
								<i class="fa fa-comments"></i>
							</div>
							<div class="details">
								<div class="number">
									{{{title}}}
								</div>
								<div class="desc">
									{{{desc}}}
								</div>
							</div>
						</div>
					</script>

					<script id="template-slide" type="text/x-handlebars-template">
						<div class="panel panel-default">
								{{#if title}}
								<div class="panel-heading">
									<h3 class="panel-title">{{{title}}}</h3>
								</div>
								{{/if}}
								<div class="panel-body">
									 {{{content}}}
								</div>
							</div>
					</script>

					<script id="template-code" type="text/x-handlebars-template">
						<div class="slide-editor-container">
							<button type="button" class="btn btn-success">
								Add to editor <i class="fa fa-long-arrow-right"></i>
							</button>
							<pre class="slide-editor">{{code}}</pre>
						</div>
					</script>




				</div> <!-- End lesson flow -->
			</div> <!-- END CONTENT PANE -->
		</div>
	</div> <!-- END CONTENT -->
	
</div>
<!-- END CONTAINER -->
<!-- BEGIN FOOTER -->
<div class="page-footer">
	<div class="page-footer-inner">
		 2014 &copy; <a href="https://www.sigmaforge.com" title="Visit our website" target="_blank">Sigma Forge Ltd </a>
	</div>
</div>
<!-- END FOOTER -->
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="assets/global/plugins/respond.min.js"></script>
<script src="assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="assets/global/plugins/jqvmap/jqvmap/jquery.vmap.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.russia.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.world.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.europe.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.germany.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.usa.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/data/jquery.vmap.sampledata.js" type="text/javascript"></script>
<script src="assets/global/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.pulsate.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js" type="text/javascript"></script>
<!-- IMPORTANT! fullcalendar depends on jquery-ui.min.js for drag & drop support -->
<script src="assets/global/plugins/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-easypiechart/jquery.easypiechart.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="assets/admin/pages/scripts/index.js" type="text/javascript"></script>
<script src="assets/admin/pages/scripts/tasks.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->


<script src="js/jqconsole.js"></script>
<script src="js/mousetrap.min.js"></script>
<script src="js/handlebars-v3.0.3.js"></script>

<!-- bring in Lisp -->
<script src="js-lisps/js-lisp.git/build/lisp.js"></script>

<!-- lisp scripts -->
<script type="text/lisp" src="lisp/core.lisp"></script>
<script type="text/lisp" src="lisp/setup.lisp"></script>
<script type="text/lisp" src="lisp/talk.lisp"></script>


<script src="/ace/ace.js" type="text/javascript" charset="utf-8"></script>


<script>

function toggleFullScreen() {
  if (!document.fullscreenElement &&    // alternative standard method
      !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement ) {  // current working methods
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen();
    } else if (document.documentElement.msRequestFullscreen) {
      document.documentElement.msRequestFullscreen();
    } else if (document.documentElement.mozRequestFullScreen) {
      document.documentElement.mozRequestFullScreen();
    } else if (document.documentElement.webkitRequestFullscreen) {
      document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
    }
    $("#fullscreen-toggle i").addClass("icon-size-actual").removeClass("icon-size-fullscreen");
  } else {

    if (document.exitFullscreen) {
      document.exitFullscreen();
    } else if (document.msExitFullscreen) {
      document.msExitFullscreen();
    } else if (document.mozCancelFullScreen) {
      document.mozCancelFullScreen();
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
    }
    $("#fullscreen-toggle i").addClass("icon-size-fullscreen").removeClass("icon-size-actual");
  }
}

$(function(){


	// set up editor.
	window.editor = ace.edit("main-editor");
    window.editor.setFontSize(20);
    window.editor.renderer.setShowGutter(true);
    window.editor.renderer.setShowInvisibles(false);
    window.editor.setTheme("ace/theme/clouds");
    window.editor.getSession().setMode("ace/mode/lisp");

	// Enable fullscreen toggle
	$("#fullscreen-toggle").click(function(e){
		toggleFullScreen();
	});

	// scroll console pane when we change the console contents
	MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
	var observer = new MutationObserver(function(mutations, observer) {
	    // console.log(mutations, observer);
	    $("#console-container").scrollTop($('#console-container')[0].scrollHeight);
	});
	observer.observe($("#console-container")[0], {
	  subtree: true,
	  attributes: true
	});
	

	// Load all the lisp script
	// TODO: update lisp.js so that it uses something more sensible than XHR.open()...
	$('script[type="text/lisp"]').each(function(i,el){
		lisp.load($(el).attr('src'));
	});

	

	function reloadEditor(){
		var forms = editor.getValue();
		// console.log("editor sending", editor.getValue());
		$(".editor-status").hide();
		$(".editor-status.editor-loading").show();
    	
    	// try for parsing errors
    	try{
    		lisp.parse.script(forms);
    	}catch(err){
    		console.warn(err.message + " (Don't worry if the editor is green!)");
    		$(".editor-status").hide();
    		$("#editor-buttons p.text-danger").show().text(err.message);
    		$(".editor-status.editor-error").show();
    		return;
    	}

    	// eval the forms 
    	try{
    		lisp.eval(forms);
    	}catch(err){
    		console.error(err.message);
    		$(".editor-status").hide();
    		$("#editor-buttons p.text-danger").show().text(err.message);
    		$(".editor-status.editor-error").show();
    		return;
    	}

    	$("#editor-buttons p.text-danger").hide();
    	$(".editor-status").hide();
		$(".editor-status.editor-ok").show();
	}

	window.editor.getSession().on('change', function(e) {
		reloadEditor();
	});
	
	var original_env = lisp.env;

	//load the default editor
	$.ajax({
		url: "/lisp/editor-default.lisp",
		dataType: "text"
	}).done(function(data){
		window.editor.setValue(data);
		window.editor.clearSelection();
	});

	
	window.prompt = $('#prompt').jqconsole(null, '➤ ', '...   ');

	// Abort prompt on Ctrl+Z.
    window.prompt.RegisterShortcut('Z', function() {
      	window.prompt.AbortPrompt();
      	window.prompt.Clear();
		window.prompt.Prompt(true, handle, is_multiline);
    });
    // Move to line start Ctrl+A.
    window.prompt.RegisterShortcut('A', function() {
      window.prompt.MoveToStart();
    });
    // Move to line end Ctrl+E.
    window.prompt.RegisterShortcut('E', function() {
      window.prompt.MoveToEnd();
    });
    // Clear window.prompt with Ctrl+C
    window.prompt.RegisterShortcut('C', function() {
    	window.prompt.AbortPrompt();
      	window.prompt.Clear();
		window.prompt.Prompt(true, handle, is_multiline);
    });
    window.prompt.RegisterMatching('{', '}', 'brace');
    window.prompt.RegisterMatching('(', ')', 'paran');
    window.prompt.RegisterMatching('[', ']', 'bracket');
    window.prompt.SetIndentWidth(4); 

	function add_expression(exp){
		var $el = $("<div>").addClass("console-item").addClass("exp").text(exp);
		// syntax highlight using ace?
		$("#history").append($el)
	}
	
	function add_result(res, exp){
		if(res instanceof Array){
			res = lisp.toLisp(res);
		} else if (res instanceof Function){
			res = "#<function "+exp+" ...>";
		} else if(res instanceof lisp.Macro){
			res = "#<macro "+exp+" ...>";
		}
		var $el = $("<div>").addClass("console-item").addClass("result").text(res);
		// syntax highlight using ace?
		$("#history").append($el);
	}

	function add_error(err){
		var $el = $("<div>").addClass("console-item").addClass("err").text(err);
		// syntax highlight using ace?
		$("#history").append($el);
	}

	function doLisp(exp){
		try{
			var res = lisp.eval(exp);
			if(res === undefined){
				throw {message:"undefined"};
			}else{
				add_result(res, exp);
			}
		}catch(err){
			add_error(err.message);
		}
	}

	function handle(expression){

		// add expression to history
		add_expression(expression);
		doLisp(expression);
		
		window.prompt.Clear();
		window.prompt.Prompt(true, handle, is_multiline);
		return false;
	};

	function is_multiline(input){
		// check it doesn't finish with 2 newlines.
		if(input.slice(-2) == "\n\n"){
			return false
		}

		// check if it parses
		try{
			lisp.parse.any(input);
		}catch(err){
			if(err.message.slice(0,11) == "EOF reached"){
				console.log("Unfinished statement");
				return 0;
			}
			return false;
		}
		return false;
	}

	window.prompt.Prompt(true, handle, is_multiline);

	window.resetLisp = function(){
		try{
			window.prompt.AbortPrompt();
		}catch(err){
			// Do nothing
		}
      	window.prompt.Clear();
		window.prompt.Prompt(true, handle, is_multiline);
		$("#history").empty("");
		lisp.env = original_env; //TODO: This doesn't work! how do we reset the bugger?
		reloadEditor();
	}

	$("#editor-pane .tools > a.reload").click(function(){
		console.log("Reseting Lisp Environment");
		resetLisp();
	});

	// redirect all focus to console
	$(window).click(function() {  
      prompt.Focus();  
    })

  	// init metronic core componets
  	Metronic.init(); 

  	// init layout
  	Layout.init(); 
  	

});
</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>